{% extends "base.html" %}

{% block title %}Pinballs - Pincrawl{% endblock %}

{% block content %}
<div class="min-h-screen bg-dark-grey flex flex-col">

    {% include "header.html" %}

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8 w-full">

        <!-- Search Section -->
        <div class="text-center mt-12 mb-12 ">
            <h2 class="text-3xl font-bold text-retro-cyan mb-8 retro-glow">Browse Pinball Machines</h2>

            <!-- Search Bar -->
            <div class="max-w-2xl mx-auto mb-8">
                <form method="get" action="/pinballs" class="relative">
                    <div class="relative flex items-stretch">
                        <input
                            type="text"
                            name="query"
                            placeholder="Search for pinball machines..."
                            value="{{ query or '' }}"
                            class="w-full px-6 py-4 text-lg text-white bg-medium-grey border border-retro-cyan focus:outline-none focus:border-retro-pink focus:ring-1 focus:ring-retro-pink transition-all duration-300 placeholder-gray-500 h-14"
                        >
                        <button
                            type="submit"
                            class="px-8 py-4 bg-retro-cyan text-black font-bold hover:bg-retro-pink transition-all duration-300 border border-retro-cyan hover:border-retro-pink h-14"
                        >
                            SEARCH
                        </button>
                    </div>
                    {% if query %}
                    <div class="mt-2 text-left">
                        <a href="/pinballs" class="text-retro-cyan hover:text-retro-pink text-sm transition-colors duration-200">
                            Clear search
                        </a>
                    </div>
                    {% endif %}
                </form>
            </div>
        </div>

        <!-- Pinballs List -->
        {% if products %}
        <div class="space-y-4 mb-8">
            {% for product in products %}
            <div class="bg-darker-grey border border-retro-white p-6 ">
                <div class="flex justify-between items-start">
                    <div class="flex-grow">
                        <h3 class="text-xl font-bold text-retro-white mb-2 retro-glow">{{ product.name }}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-300 mb-2">
                            <div>
                                {{ product.manufacturer or "Unknown" }}, {{ product.year or "Unknown" }}
                            </div>
                        </div>
                    </div>
                    <div class="ml-6 flex-shrink-0">
                        <button
                            onclick="subscribe('{{ product.opdb_id }}', '{{ product.name }}')"
                            class="px-6 py-2 text-retro-cyan font-bold transition-all duration-300 border border-retro-cyan hover:bg-retro-cyan hover:border-retro-cyan hover:text-black"
                        >
                            SUBSCRIBE
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if total_pages > 1 %}
        <div class="flex justify-center items-center space-x-4 mt-8">
            {% if has_prev %}
            <a href="/pinballs?page={{ prev_page }}{% if query %}&query={{ query }}{% endif %}"
               class="px-4 py-2 bg-medium-grey text-retro-cyan border border-retro-cyan hover:bg-retro-cyan hover:text-black transition-all duration-300">
                Previous
            </a>
            {% endif %}

            <span class="text-gray-300">
                Page {{ current_page }} of {{ total_pages }}
            </span>

            {% if has_next %}
            <a href="/pinballs?page={{ next_page }}{% if query %}&query={{ query }}{% endif %}"
               class="px-4 py-2 bg-medium-grey text-retro-cyan border border-retro-cyan hover:bg-retro-cyan hover:text-black transition-all duration-300">
                Next
            </a>
            {% endif %}
        </div>
        {% endif %}

        {% else %}
        <!-- No Results -->
        <div class="text-center py-12">
            <h3 class="text-2xl font-bold text-gray-400 mb-4">No pinball machines found</h3>
            {% if query %}
            <p class="text-gray-500 mb-4">Try adjusting your search terms or browse all machines.</p>
            {% else %}
            <p class="text-gray-500">Check back later for new listings!</p>
            {% endif %}
        </div>
        {% endif %}

    </main>

    {% include "footer.html" %}
</div>

<script>
function subscribe(pinballId, pinballName) {
    // TODO: Implement subscription functionality
    alert(`Subscribing to alerts for: ${pinballName} (ID: ${pinballId})`);

    // Here you would make an API call to your subscription endpoint
    // fetch('/api/subscribe', {
    //     method: 'POST',
    //     headers: { 'Content-Type': 'application/json' },
    //     body: JSON.stringify({ pinball_id: pinballId })
    // });
}
</script>

{% endblock %}